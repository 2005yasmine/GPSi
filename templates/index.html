<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Démo GPS Intelligent</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body, html { margin:0; padding:0; height:100%; font-family: 'Segoe UI', sans-serif; background:#121212; color:#f0f0f0;}
        h1 { text-align:center; margin:20px 0; font-weight:600; color:#f39c12;}
        #map { height: 90vh; width: 95%; margin:0 auto; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.7); position:relative;}

        .leaflet-popup-content-wrapper {
            border-radius:12px;
            background:#1f1f1f;
            color:#f0f0f0;
            padding:12px 16px;
            box-shadow:0 2px 8px rgba(0,0,0,0.7);
        }
        .leaflet-popup-content b { color:#f39c12; font-size:1.1em; }
        .leaflet-popup-content p { margin:4px 0; }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(30,30,30,0.9);
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.7);
            font-size:14px;
            line-height:1.5;
            color:#f0f0f0;
            z-index:1000;
        }
        .legend span {
            display:inline-block;
            width:14px;
            height:14px;
            margin-right:6px;
            border-radius:50%;
        }

        .glow {
            filter: drop-shadow(0 0 12px rgba(255,255,255,0.6));
        }
    </style>
</head>
<body>
    <h1>GPSi</h1>
    <div id="map">
        <div class="legend">
            <div><span style="background:#e74c3c;"></span>Risque élevé</div>
            <div><span style="background:#f39c12;"></span>Risque moyen</div>
            <div><span style="background:#2ecc71;"></span>Risque faible</div>
        </div>
    </div>

    <script>
        const demoData = {{ data|tojson }};
        const map = L.map('map');

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution:'&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> &copy; <a href="https://carto.com/">CARTO</a>',
            subdomains:'abcd',
            maxZoom:19
        }).addTo(map);

        const markers = [];
        demoData.forEach(row => {
            const color = row.Risk_Level == 2 ? '#e74c3c' : row.Risk_Level == 1 ? '#f39c12' : '#2ecc71';

            const marker = L.circleMarker([row.Latitude, row.Longitude], {
                radius:14,
                color: color,
                fillColor: color,
                fillOpacity:0.9,
                weight:2,
                className:'glow'
            }).bindPopup(
                `<b>${row.Road_Name}</b>
                 <p><strong>Niveau de risque :</strong> ${row.Risk_Level}</p>
                 <p><strong>Raison :</strong> ${row.Risk_Reason}</p>
                 <p><strong>Alternative suggérée :</strong> ${row.Suggested_Alternative}</p>`
            ).addTo(map);

            markers.push(marker.getLatLng());
        });

        if(markers.length > 0){
            const bounds = L.latLngBounds(markers);
            map.fitBounds(bounds.pad(0.2)); 
        } else {
            map.setView([33.8869, 9.5375], 6);
        }
    </script>
</body>
</html>
